"use strict";angular.module("coq",["ngResource","ngSanitize"]),angular.module("coq").config(["$provide",function(a){a.decorator("$resource",function(a){var b=function(){var b=arguments[0],c=[],d=b.split("/"),e=a.apply(a,arguments);return angular.forEach(d,function(a){":"===a[0]&&c.push(a.substr(1))}),e.$$routeVariables=c,e};return b})}]),angular.module("coq").provider("Coq",function(){function a(a){return a}this.$conditionBuilder=a,this.$get=["$q",function(a){function b(b){function c(a){return this.$resource[a](this.$toObject()).$promise}function d(b,c){return a.pipeline(this.callbacks["$"+c+b])}angular.isObject(b)&&angular.forEach(b,function(a,b){angular.isFunction(a)||"$"===b[0]||-1===Object.keys(this.constructor.$attributesDefinition).indexOf(b)||(this[b]=a)},this);var e={save:"save",destroy:"delete"};angular.isFunction(this.$resource.update)&&(e.update="update"),angular.forEach(e,function(b,e){var f=e[0].toUpperCase()+e.substr(1);this[e]=function(){var e=a.defer();return d.call(this,f,"before").then(angular.bind(this,c,b),e.reject).then(angular.bind(this,d,f,"after"),e.reject).then(e.resolve,e.reject),e.promise}},this),this.$toObject=function(){var a={};return angular.forEach(this,function(b,c){!angular.isFunction(b)&&this.hasOwnProperty(c)&&-1!==Object.keys(this.constructor.$attributesDefinition).indexOf(c)&&(a[c]=b)},this),a}}function c(b,c){b.find=function(d){var e=a.defer(),f={};if(b.$primaryKey||1!==b.$resource.$$routeVariables.length)b.$primaryKey&&(f[b.$primaryKey]=d);else{var g=!1;angular.forEach(b.$resource.$$routeVariables,function(a){angular.forEach(b.$attributesDefinition,function(b,c){a===c&&(g=c)})}),g&&(f[g]=d)}return Object.keys(f).length?c.get(f,function(a){var d=new b(a);d.$resource=c,e.resolve(d)},e.reject):e.reject(new Error("unable to locate primary key")),e.promise},b.where=function(d){var e=a.defer();return c.query(d,function(a){var d=[];angular.forEach(a,function(a){var e=new b(a);e.$resource=c,d.push(e)}),e.resolve(d)},e.reject),e.promise},b.all=function(){return b.where({})}}function d(a){function d(){d.superconstructor.apply(this,arguments)}if(!angular.isObject(a))throw new Error("config parameter missing");if(!a.$resource||!a.$resource.$$routeVariables)throw new Error("model declaration : resource object invalid");extend(d,b);var h={};angular.forEach(g,function(a){h[a]=[]}),d.prototype.callbacks=h;var i={};angular.forEach(a,function(a,b){-1!==g.indexOf(b)?d.prototype.callbacks[b]=angular.isArray(a)?a:[a]:-1===e.indexOf(b)&&(i[b]=a)}),angular.extend(d.prototype,i);var j={};if(angular.isObject(a.$statics)&&(angular.forEach(a.$statics,function(a,b){-1===f.indexOf(b)&&(j[b]=a)}),angular.extend(d,j)),d.$resource=a.$resource,c(d,d.$resource),d.$attributesDefinition=a.$attributes||{},a.$primaryKey){if(-1===Object.keys(d.$attributesDefinition).indexOf(a.$primaryKey))throw new Error('$primaryKey "'+a.$primaryKey+'" not in $attributes');d.$primaryKey=a.$primaryKey}return d}var e=["$attributes","$statics","$primaryKey"],f=["find","all"],g=["$beforeSave","$afterSave","$beforeDestroy","$afterDestroy","$beforeUpdate","$afterUpdate"];return{factory:d}}]}),angular.module("coq").config(["$provide",function(a){a.decorator("$q",function(a){return a.pipeline=function(b,c){var d=b.length;return d?function(){function e(c,g){a.when(b[c](g)).then(function(a){d>c+1?e(c+1,a):f.resolve(a)},function(a){f.reject(a)})}var f=a.defer();return e(0,c),f.promise}():a.when(c)},a})}]),angular.module("coq").service("coqModelFormInputs",function(){return{text:{type:"text"},number:{type:"number"},email:{type:"email"},url:{type:"url"},radio:{type:"radio"},hidden:{type:"hidden"},checkbox:{type:"checkbox"}}}),angular.module("coq").provider("coqModelForm",function(){var a=["coqModelFormInputs"];this.registerInputs=function(b){a.push(b)},this.$get=["$injector",function(b){var c={};return angular.forEach(a,function(a){angular.extend(c,b.get(a))}),{getInputAttributes:function(a){return angular.isString(a)?c[a]||{}:a}}}]}),angular.module("coq").directive("coqModelAttribute",["$compile","$log","coqModelForm",function(a,b,c){return{priority:101,require:"?^coqModel",restrict:"A",link:function(a,d,e,f){if(!f)return void b.error("coq-model-attribute need a parent element with coq-model directive");var g=f.coqModel.$attributesDefinition[e.coqModelAttribute]||!1;g&&(d.attr(c.getInputAttributes(g)),d.attr("ng-model",f.coqModelName+"."+e.coqModelAttribute))}}}]),angular.module("coq").controller("coqModelController",["$scope","$parse",function(a,b){this.init=function(c){this.coqModel=b(c.coqModel)(a).constructor,this.coqModelName=c.coqModel,this.insertMode=-1!==["append","replace","prepend"].indexOf(c.coqModelInsertMode)?c.coqModelInsertMode:"append"}}]),angular.module("coq").directive("coqModel",["$compile",function(a){return{terminal:!0,controller:"coqModelController",restrict:"A",link:{pre:function(b,c,d,e){if(e.init(d),"FORM"===c[0].tagName&&!$(c).find("input[coq-model-attribute]").length){var f,g,h=[];angular.forEach(e.coqModel.$attributesDefinition,function(a,b){f=document.createElement("p"),g=document.createElement("input"),angular.element(g).attr("coq-model-attribute",b),angular.element(f).append(g),h.push(f)}),"replace"===e.insertMode?(c.empty(),c.append(h)):c[e.insertMode](h),a(c.contents())(b),h=null}},post:function(b,c){a(c.contents())(b)}}}}]);